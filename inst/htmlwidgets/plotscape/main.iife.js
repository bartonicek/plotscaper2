var plotscape=function(h){"use strict";var En=Object.defineProperty;var Kn=(h,j,T)=>j in h?En(h,j,{enumerable:!0,configurable:!0,writable:!0,value:T}):h[j]=T;var c=(h,j,T)=>(Kn(h,typeof j!="symbol"?j+"":j,T),T);var j=document.createElement("style");j.textContent=`html,body{width:100%;height:100%}#app{margin:1%;width:98%;height:98%}.ps-scene-container{background-color:#deded9;width:100%;height:100%;position:relative;display:grid!important;grid-template-columns:repeat(var(--ncols),1fr);grid-template-rows:repeat(var(--nrows),1fr);box-sizing:border-box;padding:5%;grid-gap:20px;overflow:hidden}.ps-plot-container{position:relative;border:1px solid black;border:2px solid transparent}.ps-plot-container.active{border:2px solid #7a7a7a}.ps-plot-context{position:absolute;top:0;right:0;width:100%;height:100%}.ps-plot-context.inner{top:20px;right:20px;width:calc(100% - 60px);height:calc(100% - 60px);border-bottom:1px solid black;border-left:1px solid black}.ps-help-button{position:absolute;top:0;right:0;width:30px;height:30px;font-weight:700;float:right;border:none;font-weight:100;font-size:medium}.ps-help-modal{font-size:min(2.5vmin,14pt);color:#3d3d3d;padding:2.5%;background-color:#fefffe;border:1px solid #3d3d3d;overflow:hidden}.ps-help-modal-heading{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif;line-height:.5;margin:0;padding:0;text-shadow:1px 1px 2px #deded9}.ps-help-modal ul{list-style-type:none;line-height:1.2}.ps-widget-modal{font-size:min(2.5vmin,14pt);color:#3d3d3d;background-color:#fefffe;border:1px solid #3d3d3d;padding:2.5%}.ps-widget-container{display:block}.ps-widget{margin-left:4px;list-style:none}.ps-widget button{border:none}.ps-query-display{display:none;white-space:nowrap;z-index:30;position:absolute;width:fit-content;background-color:#fff;border:1px solid #7a7a7a;padding:2%;pointer-events:none}
`,document.head.appendChild(j);const T=s=>()=>s;function ke(s){return function(t){return s(t)}}const Jt=T(0),Oe=T(1),xs=T({});function vs(){}function H(){return this}function V(s){return function(...t){return s(...t),this}}function Y(s){return s}function ws(s){return s()}function As(s,...t){return s}function Ms(s,t,...e){return t}function Pt(s,t){return function(){s(),t()}}function Ss(s){return s.value()}function Ne(s){return function(t){return s[t]}}const Ps=ke(document.createElement.bind(document));function zt(s){return s**2}function U(s){return Math.sqrt(s)}function Ce(s){return s+1}function De(s){return function(t){return s*t}}function Re(s){return s.toString()}function qe(s){return parseInt(s,10)}async function zs(s){return await(await fetch(s)).json()}function Be(s){return s.charAt(0).toUpperCase()+s.slice(1)}function _(s,t){return s-t}function je(s,t){return s+t}function Te(s,t){return s*t}function $t(s,t){return s.localeCompare(t,"en",{numeric:!0})}function Z(s,t,e){return Math.min(Math.max(s,t),e)}function te(s){return Z(s,0,1)}function gt(s){return s[s.length-1]}function J(s,t,e){const n=Math.abs(t-s);e=e??Math.ceil(n)+1;const r=n/(e-1),o=t>=s?1:-1;return Array.from(Array(e),(i,a)=>s+o*r*a)}function kt(s){let[t,e]=[1/0,-1/0];for(let n=0;n<s.length;n++)t=Math.min(t,s[n]),e=Math.max(e,s[n]);return[t,e]}function ks(s){const t=[s[0]];for(let e=1;e<s.length;e++)s.push(s[e]+t[e-1]);return t}function _e(s,t){const e=[...s];return e.sort((n,r)=>Math.sign(t[e.indexOf(n)]-t[e.indexOf(r)])),e}function Os(s,t){const e=[];for(let n=0;n<s.length;n++)e.push(t.indexOf(s[n]));return e}function ee(s){return Object.keys(s)}function Ns(s){return Object.values(s)}function ut(s){return Object.entries(s)}function se(s){return Reflect.ownKeys(s)}function Ee(s){const t=[];for(const e of se(s))t.push(s[e]);return t}function I(s){const t=[];for(const e of se(s))t.push([e,s[e]]);return t}function Cs(s){const t={};for(const[e,n]of I(s))t[e]=n.value();return t}function ne(s,t){let e=0;return(...n)=>{const r=new Date().getTime();r-e<t||(e=r,s(...n))}}function re(s,t){for(const e of t)s.add(e);return s}function D(s){return function(t){return s.reduce((e,n)=>n(e),t)}}function ot(s,t){const e=1/(t-s);return[-s*e,e-s*e,e]}function Ke(s,t,e=4){const n=(t-s)/e,r=Math.floor(Math.log10(n)),o=[1,2,4,5,10];let[i,a]=[1/0,0];for(let f=0;f<o.length;f++){const $=(o[f]*10**r-n)**2;$<i&&([i,a]=[$,o[f]])}const l=10**r*a,u=Math.ceil(s/l)*l,m=Math.floor(t/l)*l,p=Math.round((m-u)/l),d=[];for(let f=0;f<p+1;f++){const $=u+f*l;d.push($)}return d.push(m),d}const Ds={"-":"⁻","+":"",0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹"};function We(s){return s.split("").map(Ne(Ds)).join("")}function Ie(s){let[t,e]=s.split("e");return e=We(e),t+"×10"+e}const Le={equals:(s,t)=>s===t};let Xe=Qe;const it=1,Ot=2,Fe={owned:null,cleanups:null,context:null,owner:null};var O=null;let oe=null,Rs=null,M=null,k=null,L=null,Nt=0;function qs(s,t){const e=M,n=O,r=s.length===0,o=t===void 0?n:t,i=r?Fe:{owned:null,cleanups:null,context:o?o.context:null,owner:o},a=r?s:()=>s(()=>S(()=>Rt(i)));O=i,M=null;try{return dt(a,!0)}finally{M=e,O=n}}function x(s,t){t=t?Object.assign({},Le,t):Le;const e={value:s,observers:null,observerSlots:null,comparator:t.equals||void 0},n=r=>(typeof r=="function"&&(r=r(e.value)),Ge(e,r));return[Bs.bind(e),n]}function ht(s,t,e){Xe=Es;const n=Ts(s,t,!1,it);(!e||!e.render)&&(n.user=!0),L?L.push(n):ie(n)}function E(s){return dt(s,!1)}function S(s){if(M===null)return s();const t=M;M=null;try{return s()}finally{M=t}}function Bs(){if(this.sources&&this.state)if(this.state===it)ie(this);else{const s=k;k=null,dt(()=>Dt(this),!1),k=s}if(M){const s=this.observers?this.observers.length:0;M.sources?(M.sources.push(this),M.sourceSlots.push(s)):(M.sources=[this],M.sourceSlots=[s]),this.observers?(this.observers.push(M),this.observerSlots.push(M.sources.length-1)):(this.observers=[M],this.observerSlots=[M.sources.length-1])}return this.value}function Ge(s,t,e){let n=s.value;return(!s.comparator||!s.comparator(n,t))&&(s.value=t,s.observers&&s.observers.length&&dt(()=>{for(let r=0;r<s.observers.length;r+=1){const o=s.observers[r],i=oe&&oe.running;i&&oe.disposed.has(o),(i?!o.tState:!o.state)&&(o.pure?k.push(o):L.push(o),o.observers&&He(o)),i||(o.state=it)}if(k.length>1e6)throw k=[],new Error},!1)),t}function ie(s){if(!s.fn)return;Rt(s);const t=Nt;js(s,s.value,t)}function js(s,t,e){let n;const r=O,o=M;M=O=s;try{n=s.fn(t)}catch(i){return s.pure&&(s.state=it,s.owned&&s.owned.forEach(Rt),s.owned=null),s.updatedAt=e+1,Ve(i)}finally{M=o,O=r}(!s.updatedAt||s.updatedAt<=e)&&(s.updatedAt!=null&&"observers"in s?Ge(s,n):s.value=n,s.updatedAt=e)}function Ts(s,t,e,n=it,r){const o={fn:s,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:O,context:O?O.context:null,pure:e};return O===null||O!==Fe&&(O.owned?O.owned.push(o):O.owned=[o]),o}function Ct(s){if(s.state===0)return;if(s.state===Ot)return Dt(s);if(s.suspense&&S(s.suspense.inFallback))return s.suspense.effects.push(s);const t=[s];for(;(s=s.owner)&&(!s.updatedAt||s.updatedAt<Nt);)s.state&&t.push(s);for(let e=t.length-1;e>=0;e--)if(s=t[e],s.state===it)ie(s);else if(s.state===Ot){const n=k;k=null,dt(()=>Dt(s,t[0]),!1),k=n}}function dt(s,t){if(k)return s();let e=!1;t||(k=[]),L?e=!0:L=[],Nt++;try{const n=s();return _s(e),n}catch(n){e||(L=null),k=null,Ve(n)}}function _s(s){if(k&&(Qe(k),k=null),s)return;const t=L;L=null,t.length&&dt(()=>Xe(t),!1)}function Qe(s){for(let t=0;t<s.length;t++)Ct(s[t])}function Es(s){let t,e=0;for(t=0;t<s.length;t++){const n=s[t];n.user?s[e++]=n:Ct(n)}for(t=0;t<e;t++)Ct(s[t])}function Dt(s,t){s.state=0;for(let e=0;e<s.sources.length;e+=1){const n=s.sources[e];if(n.sources){const r=n.state;r===it?n!==t&&(!n.updatedAt||n.updatedAt<Nt)&&Ct(n):r===Ot&&Dt(n,t)}}}function He(s){for(let t=0;t<s.observers.length;t+=1){const e=s.observers[t];e.state||(e.state=Ot,e.pure?k.push(e):L.push(e),e.observers&&He(e))}}function Rt(s){let t;if(s.sources)for(;s.sources.length;){const e=s.sources.pop(),n=s.sourceSlots.pop(),r=e.observers;if(r&&r.length){const o=r.pop(),i=e.observerSlots.pop();n<r.length&&(o.sourceSlots[i]=n,r[n]=o,e.observerSlots[n]=i)}}if(s.owned){for(t=s.owned.length-1;t>=0;t--)Rt(s.owned[t]);s.owned=null}if(s.cleanups){for(t=s.cleanups.length-1;t>=0;t--)s.cleanups[t]();s.cleanups=null}s.state=0}function Ks(s){return s instanceof Error?s:new Error(typeof s=="string"?s:"Unknown error",{cause:s})}function Ve(s,t=O){throw Ks(s)}const ft={defaultWidth:.75,defaultNormX:.05,defaultNormY:.05,axisTitleFontsize:18,axisLabelFontsize:14,marginLines:[4,4,1,1],groupColors:["#A55DB0","#F53132","#58B956","#498AC5","#DBA8E3","#F1ACAC","#9DE19C","#9FC4F0"]};function tt(s,t){const[e,n]=[s[0],s[2]].sort(_),[r,o]=[s[1],s[3]].sort(_),[i,a]=[t[0],t[2]].sort(_),[l,u]=[t[1],t[3]].sort(_);return!(n<i||e>a||o<l||r>u)}function Ye(s){const[t,e,n,r]=s;return[t,e,n-t,r-e]}function Ue(s,t,e){return!(s<t)&&!(s>e)}function qt(s,t){let[e,n,r,o]=Ye(s),[i,a,l,u]=Ye(t);const m=l*o-r*u,p=((e-i)*o-(n-a)*r)/m,d=-(-(e-i)*u+(n-a)*l)/m;return Ue(p,0,1)&&Ue(d,0,1)}function Ze(s,t){const[e,n,r,o]=s;return qt([e,n,r,n],t)||qt([e,n,e,o],t)||qt([r,n,r,o],t)||qt([e,o,r,o],t)}function Bt(s,t=0){return Math.floor(s*10**t)/10**t}function ae(s){if(s===0)return s.toString();const t=Math.round(Math.log10(Math.abs(s)));return t<0?s=Bt(s,Math.abs(t)+2):t<3?s=Bt(s,2):t<3?s=Bt(s,1):s=Bt(s),s.toString()}function Je(s,t){if(!ts(s))return s;const e=(t==null?void 0:t.decimalPlaces)??4,n=i=>i!=0&&Math.abs(Math.log10(i))>e,o=kt(s).some(n)?Ws:Is;return s.map(o)}function Ws(s){return s===0?"0":Ie(s.toExponential())}function Is(s){return s===0?"0":parseFloat(s.toPrecision(12)).toString()}function bt(){const{marginLines:s,axisTitleFontsize:t}=ft;return s.map(De(t))}function Ls(s,t,e){return s===0?t:e}function ts(s){return typeof s[0]=="number"}function Xs(s){return!!s[0].toString}function es(s){return function(t){return s(),t()}}function Fs(s){const t=[];t.push(s[0]);for(let e=1;e<s.length;e++)t.push(t[e-1]+s[e]);return t}function ss(s,t){const e=[];for(let n=0;n<t;n++)e.push(s);return e}function jt(s,t){const e=Array(t.length);for(let n=0;n<t.length;n++)e[t[n]]=s[n];return e}function Gs(s,t){const e=[];for(let n=0;n<t.length;n++)e.push(s[t[n]]);return e}function ns(s){return Math.floor(Math.random()*s)}function Qs(s,t,e){const n=J(s,t),r=[],o=new Set;for(;r.length<e;){let i=ns(n.length);for(;o.has(i);)i=ns(n.length);r.push(n[i]),o.add(i)}return r}function rs(s,t,e){const n=s[t];return s[t]=s[e],s[e]=n,s}function os(s){const t=[...s].sort(_),e=[],n={};for(const r of s)n[r]===void 0?n[r]=0:n[r]++,e.push(t.indexOf(r)+n[r]);return e}function v(s){return new Hs(s)}class Hs{constructor(t){c(this,"node");this.node=document.createElement(t)}get(){return this.node}append(t){return this.node.appendChild(t),this}appendTo(t){return t.appendChild(this.node),this}text(t){return this.node.innerText=t,this}html(t){return this.node.innerHTML=t,this}listen(t,e){return this.node.addEventListener(t,e),this}setAttribute(t,e){return this.node[t]=e,this}addClass(t){return this.node.classList.add(t),this}setStyles(t){for(const[e,n]of Object.entries(t))this.node.style[e]=n;return this}}class Tt{constructor(t,e){c(this,"container");c(this,"name$");c(this,"values$");c(this,"setName$");c(this,"setValues$");this.container=v("div").addClass("ps-widget-container").get();const[n,r]=x("");this.name$=n,this.values$=t,this.setName$=r,this.setValues$=e,ht(()=>this.render$())}static of(t,e){return new Tt(t,e)}get(){return this.container}setName(t){return this.setName$(t),this}render$(){const t=this.values$(),e=this.name$(),n=v("ul").html(e).setStyles({paddingLeft:"0"}).get();for(const r of t){const o=()=>{const u=t.indexOf(r);u<1||(rs(t,u,u-1),this.setValues$(t))},i=()=>{const u=t.indexOf(r);u>=t.length-1||(rs(t,u,u+1),this.setValues$(t))},a=v("button").text("▲").addClass("ps-widget").listen("click",o).get(),l=v("button").text("▼").addClass("ps-widget").listen("click",i).get();v("li").text(r).appendTo(n).append(a).append(l).addClass("ps-widget").setStyles({marginLeft:"2vw"}).get()}this.container.replaceChildren(n)}}class ce{constructor(t,e,n,r){c(this,"name");c(this,"container");c(this,"name$");c(this,"min$");c(this,"max$");c(this,"setName$");c(this,"setMin$");c(this,"setMax$");this.container=v("div").addClass("ps-widget-container").get();const[o,i]=x("");this.name$=o,this.min$=t,this.max$=e,this.setName$=i,this.setMin$=n,this.setMax$=r,ht(()=>this.render$())}static of(t,e,n,r){return new ce(t,e,n,r)}get(){return this.container}setName(t){return this.setName$(t),this}render$(){const t=o=>{if(o.code!="Enter")return;const i=parseFloat(n.value),a=parseFloat(r.value);isNaN(i)||isNaN(a)||i>a||(this.setMin$(i),this.setMax$(a))},e=v("div").html(this.name$()).addClass("ps-widget").setStyles({display:"inline-block"}).get(),n=v("input").setAttribute("value",ae(this.min$())).setAttribute("size",5).addClass("ps-widget").setStyles({display:"inline-block"}).listen("click",o=>o.stopPropagation()).listen("keydown",t).get(),r=v("input").setAttribute("value",ae(this.max$())).setAttribute("size",5).addClass("ps-widget").setStyles({display:"inline-block"}).listen("click",o=>o.stopPropagation()).listen("keydown",t).get();this.container.replaceChildren(e,n,r)}}class w{constructor(t,e){c(this,"array");c(this,"defaultMin");c(this,"defaultMax");c(this,"min$");c(this,"max$");c(this,"setMin$");c(this,"setMax$");c(this,"_transform",Y);c(this,"_untransform",Y);this.defaultMin=t,this.defaultMax=e;const[n,r]=x(t),[o,i]=x(e);this.min$=n,this.max$=o,this.setMin$=V(r),this.setMax$=V(i)}static of(t,e){return new w(t,e)}static from(t){const[e,n]=kt(t);return w.of(e,n).setArray(t)}static default(){return new w(0,1)}retrain$(){if(!this.array)return this;const[t,e]=kt(this.array);return E(()=>this.setMin$(t).setMax$(e)),this}setArray(t){return this.array=t,this}setDefaultMin(t){return this.defaultMin=t,this.setMin$(t),this}setDefaultMax(t){return this.defaultMax=t,this.setMax$(t),this}defaultize$(){return E(()=>this.setMin$(this.defaultMin).setMax$(this.defaultMax)),this}freezeMin(){return this.setMin$=H,this}freezeMax(){return this.setMax$=H,this}scale(t){E(()=>{this.setMin$(e=>t*e),this.setMax$(e=>t*e)})}transform(t,e){return this._transform=t,this._untransform=e,this}range$(){const{_transform:t}=this;return t(this.max$())-t(this.min$())}normalize$(t){const{_transform:e}=this;return(e(t)-e(this.min$()))/this.range$()}unnormalize$(t){const{_untransform:e}=this;return e(this.min$()+t*this.range$())}breaks$(t){const e=t.domainMin$(),n=t.domainMax$();return Ke(e,n)}getWidget(t){const e=()=>t.domainMin$(),n=()=>t.domainMax$(),r=a=>t.setDomainMin$(a),o=a=>t.setDomainMax$(a),i=`Range of <b>${t.name()}</b>:`;return ce.of(e,n,r,o).setName(i).get()}}class mt{constructor(t){c(this,"array");c(this,"order$");c(this,"values$");c(this,"weights$");c(this,"cumWeights$");c(this,"setOrder$");c(this,"setValues$");c(this,"setWeights$");const e=t.length,[n,r]=x(t,{equals:!1}),[o,i]=x(J(0,e-1),{equals:!1}),[a,l]=x(ss(1,e),{equals:!1});this.values$=n,this.order$=o,this.weights$=a,this.cumWeights$=()=>Fs(_e(this.weights$(),this.order$())),this.setValues$=V(r),this.setOrder$=V(i),this.setWeights$=V(l)}static of(t){return new mt(t)}static from(t){const e=Array.from(new Set(t)).sort($t);return mt.of(e).setArray(t)}static default(){return mt.of([])}setArray(t){return this.array=t,this}orderByIndices$(t){return this.setOrder$(t),this}orderBy$(t){return this.orderByIndices$(os(t))}defaultOrder$(){const t=S(this.values$);return this.setOrder$(J(0,t.length-1)),this}retrain$(){if(!this.array)return this;const t=Array.from(new Set(this.array)).sort($t);return this.setValues$(t)}normalize$(t){const[e,n,r]=this.getBounds$(t);return(e+(n-e)/2)/r}width$(t){const[e,n,r]=this.getBounds$(t);return(n-e)/r}unnormalize$(){throw new Error("Not implemented yet")}breaks$(){const t=this.values$(),e=this.order$();return jt(t,e)}getBounds$(t){const e=this.values$(),n=this.cumWeights$(),o=this.order$()[e.indexOf(t)];return[n[o-1]??0,n[o],gt(n)]}getWidget(t){const e=()=>jt(this.values$(),this.order$()),n=r=>{const i=this.values$().map(a=>r.indexOf(a));this.setOrder$(i)};return Tt.of(e,n).setName(`Levels of <b>${t.name()}</b>: `).get()}}class xt{constructor(t){c(this,"array");c(this,"order$");c(this,"values$");c(this,"setOrder$");c(this,"setValues$");const e=t.length,[n,r]=x(t),[o,i]=x(J(0,e-1));this.values$=n,this.order$=o,this.setValues$=V(r),this.setOrder$=V(i)}static of(t){return new xt(t)}static from(t){const e=Array.from(new Set(t)).sort($t);return xt.of(e).setArray(t)}static default(){return xt.of([])}setArray(t){return this.array=t,this}retrain$(){if(!this.array)return this;const t=Array.from(new Set(this.array)).sort($t);return this.setValues$(t),this}orderBy$(t){const e=os(t);return this.setOrder$(e),this}defaultOrder$(){const t=S(this.values$);return this.setOrder$(J(0,t.length-1)),this}normalize$(t){const e=this.values$();return this.order$()[e.indexOf(t)]/(e.length-1)}unnormalize$(){throw new Error("Not implemented yet")}breaks$(){const t=this.values$(),e=this.order$();return jt(t,e)}getWidget(t){const e=()=>jt(this.values$(),this.order$()),n=r=>{const o=this.values$(),i=r.map(a=>o.indexOf(a));this.setOrder$(i)};return Tt.of(e,n).setName(`Levels of <b>${t.name()}</b>: `).get()}}const Vs=Symbol("zero"),is=Symbol("one"),et=()=>q.of(()=>0).setName(Vs),st=()=>q.of(()=>1).setName(is);function at(s){return class extends s{constructor(){super(...arguments);c(this,"_name")}name(e="[name missing]"){return this._name?this._name.toString():e}hasName(){return!!this._name}isNamed(e){return this._name===e}setName(e){return e?(this._name=e,this):this}}}var Ys=Object.defineProperty,Us=Object.getOwnPropertyDescriptor,Zs=(s,t,e,n)=>{for(var r=n>1?void 0:n?Us(t,e):t,o=s.length-1,i;o>=0;o--)(i=s[o])&&(r=(n?i(t,e,r):i(r))||r);return n&&r&&Ys(t,e,r),r};let vt=class{constructor(s,t){c(this,"factor");c(this,"parent");c(this,"source");c(this,"reducer");c(this,"result");this.source=s,this.reducer=t;const e=t.afterfn(t.initialfn()),r=Js(e).of([]).setReducer(this);r instanceof K&&(r.domain.setMin$(e),r.domain.freezeMin()),this.result=r}static of(s,t){return new vt(s,t)}formatTitle(){const{source:s,reducer:t}=this;if(s.isNamed(is)&&t.isNamed("sum"))this.setName("count");else{let e="unknown summary";t.hasName()&&(e=t.name());const n=`${e} of ${s.name()}`;this.setName(n)}return this.name()}shallowClone(){const{source:s,reducer:t}=this,e=vt.of(s,t);return e.setParent(this.parent).setFactor(this.factor),this.hasName()&&e.setName(this.name()),e}deepClone(){const s=this.shallowClone();return s.result=this.result.deepClone().setReducer(s),s}setFactor(s){return this.factor=s,this}setParent(s){return this.parent=s,this}compute(){const{source:s,factor:t,reducer:e,result:n}=this,r=n.array,o=t.cardinality();r.length=0;for(let a=0;a<o;a++)r.push(e.initialfn());const i=t.length();for(let a=0;a<i;a++){const l=t.indexAt(a);r[l]=e.reducefn(r[l],s.valueAt(a))}return this}stack(s){const{factor:t,reducer:e}=this;if(!t.parent)return this;const n=s.array,r=t.parent,o=[],i=r.cardinality();for(let l=0;l<i;l++)o.push(e.initialfn());const a=n.length;for(let l=0;l<a;l++){const u=r.indexAt(l);o[u]=e.reducefn(o[u],n[l]),n[l]=o[u]}return s}normalizeByParent(s){const{factor:t,parent:e}=this;if(!t.parent||!e)return this;const n=s.array,r=e==null?void 0:e.result.array,o=t.parent,i=o.length();for(let a=0;a<i;a++){const l=n[a],u=r[o.indexAt(a)];n[a]=l/u}return s}variable(){return this.hasName()&&this.result.setName(this.name()),this.result}};vt=Zs([D([at])],vt);function Js(s){const t=typeof s;return t==="number"?K:t==="string"?nt:R}function _t(s){return class extends s{shallowClone(){return Object.create(this)}}}var tn=Object.defineProperty,en=Object.getOwnPropertyDescriptor,sn=(s,t,e,n)=>{for(var r=n>1?void 0:n?en(t,e):t,o=s.length-1,i;o>=0;o--)(i=s[o])&&(r=(n?i(t,e,r):i(r))||r);return n&&r&&tn(t,e,r),r};h.Dataframe=class{constructor(t,e,n){c(this,"columns");c(this,"reducers");c(this,"queryables");this.columns=t,this.reducers=e??{},this.queryables=n??[]}static of(t,e,n){return new h.Dataframe(t,e,n)}static parseColumns(t,e,n){const r={},o=h.Dataframe.of(r);let i=0;const{nMaxRows:a,nSubsample:l}=n??{},u=Object.values(t)[0].length,m=Qs(0,u-1,l??1);for(const[p,d]of Object.entries(e)){nn(t,p),rn(t,p),i||(i=t[p].length),on(t,p,i);let f=t[p];l&&(f=Gs(f,m)),a&&f.length>a&&(f.length=a),d.hasName()||d.setName(p);const $=d.parse(f);$.isQueryable()&&o.queryables.push($),r[p]=$}return o}n(){if(this.cachedN)return this.cachedN();for(const t of Ee(this.columns))if(t.n)return this.cachedN=t.n.bind(t),this.cachedN();throw new Error("No fixed-length variable present in the data")}keys(){return ee(this.columns)}has(t){return this.keys().includes(t)}cols(){return this.columns}col(t){return this.columns[t]}row(t,e){e=e??{};for(const[n,r]of I(this.columns)){if(r instanceof yt){e[n]=[];const o=r.length();for(let i=0;i<o;i++)e[n].push(r.valueAt(t,i));continue}e[n]=r.valueAt(t)}return e}rows(){const t=[],e=this.n();for(let n=0;n<e;n++)t.push(this.row(n));return t}select(t){const e=t(this.columns);return h.Dataframe.of(e,{},this.queryables)}create(t,e){const n=this.columns;return n[t]=e(this.columns),h.Dataframe.of(n,this.reducers,this.queryables)}zip(t,e){const n=e(this.columns),r=yt.of(Object.values(n)),o=this.columns;return o[t]=r,h.Dataframe.of(o,this.reducers,this.queryables)}join(t){if(this.n()!=t.n())throw new Error("Cannot join datasets of different length.");const e={};for(const[n,r]of I(this.cols()))e[n]=r;for(const[n,r]of I(t.cols()))e[n]=r;return h.Dataframe.of(e,this.reducers,this.queryables)}addReducer(t,e,n){const r=this.reducers,o=e(this.columns);return r[t]=vt.of(o,n).setName(t),h.Dataframe.of(this.columns,r)}reduceBy(t,e){const{reducers:n}=this,r={},o=e?S(e):void 0;for(const[a,l]of ut(n)){const u=l.shallowClone();if(u.setFactor(t).compute(),r[a]=u.variable(),o){const m=t.parent.indices(),p=o.col(a).proxy(m);r[a].setParent(p),u.setParent(o.reducers[a])}n[a]=u}const i=t.data().cols();for(const[a,l]of I(i))r[a]=l;return h.Dataframe.of(r,n)}addToQueries(t){return this.queryables.push(this.columns[t]),this}proxy(t){const e=this.shallowClone();e.cachedN=()=>t.length;for(const[n,r]of I(this.columns))e.columns[n]=r.proxy(t);return e}},h.Dataframe=sn([D([_t])],h.Dataframe);function nn(s,t){if(!(t in s))throw new Error(`Property ${t} is missing`)}function rn(s,t){if(!Array.isArray(s[t]))throw new Error(`Property ${t} is not an array`)}function on(s,t,e){if(s[t].length!=e)throw new Error("Array is of different length")}const le=Symbol("layer"),pt=Symbol("positions"),an=Symbol("parent");class X{constructor(t,e,n,r){c(this,"_cardinality");c(this,"_indices");c(this,"_data");c(this,"parent",new cn);this._cardinality=t,this._indices=e,this._data=n,r&&(this.parent=r)}static of(t,e,n,r){return new X(t,e,n,r)}cardinality(){return this._cardinality}length(){return this._indices.length}indices(){return this._indices}indexAt(t){return this._indices[t]}data(){return this._data}nest(t){return hn(this,t)}}class cn{cardinality(){return 1}indexAt(){return 0}data(){return h.Dataframe.of({})}}function ln(s,t){const e=s.values();t=t??s.domain.values$();const n=[],r={};for(let l=0;l<e.length;l++){const u=t.indexOf(e[l].toString());r[u]||(r[u]=new Set),r[u].add(l),n.push(u)}const o=mt.of(t),i={label:nt.of(t,o)};i[pt]=R.of(Object.values(r)),i.label.setName(s.name());const a=h.Dataframe.of(i);return X.of(t.length,n,a)}function un(s,t,e){const n=s.values(),r=s.domain.min$(),o=s.domain.max$(),i=t?Math.ceil((o-r)/t)+1:10;t=t??(o-r)/(i-1),e=e??r;const a=r-t+(e-r)%t,l=o+t-(o-e)%t,u=Array(i+2);u[0]=a,u[u.length-1]=l;for(let A=1;A<u.length-1;A++)u[A]=a+A*t;const m=new Set,p=[],d={};for(let A=0;A<n.length;A++){const W=u.findIndex(_n=>_n>=n[A])-1;d[W]||(d[W]=new Set),d[W].add(A),m.add(W),p.push(W)}const f=Array.from(m).sort(_),$={};for(const[A,W]of Object.entries(f))$[W]=qe(A);const y=p;for(let A=0;A<y.length;A++)y[A]=$[y[A]];const b=[];for(const A of f)b.push(u[A]);b.push(u[gt(f)+1]);const z=w.from(b),g=K.of(u,z),P=g.proxy(f),St=g.proxy(f.map(Ce)),B=g.derive((A,W)=>(W.valueAt(A-1)+W.valueAt(A))/2).setDomain(z),C={bin0:P,bin1:St,binMid:B};C.bin0.setName(s.name()),C.bin1.setName(s.name()),C.binMid.setName(s.name()),C[pt]=R.of(Object.values(d));const Tn=h.Dataframe.of(C);return X.of(f.length,y,Tn)}function hn(s,t){const e=Math.max(s._cardinality,t._cardinality)+1,n=s._indices,r=t._indices,o=[],i=new Set,a={},l={},u={};for(let g=0;g<n.length;g++){const P=e*n[g]+r[g];P in a||(a[P]=n[g],l[P]=r[g],u[P]=new Set),o.push(P),i.add(P),u[P].add(g)}const m=Array.from(i).sort(_),p=[];for(let g=0;g<o.length;g++)p.push(m.indexOf(o[g]));let d={};const f=Object.values(a),$=Object.values(l);for(const[g,P]of I(s._data.cols()))d[g]=P.proxy(f).setName(P.name());for(let[g,P]of I(t._data.cols())){if(typeof g=="string")for(;g in d;)g+="$";d[g]=P.proxy($).setName(P.name())}d[pt]=R.of(Object.values(u)),d[an]=R.of(Object.values(a));const y=i.size,b=h.Dataframe.of(d),z=X.of(s._cardinality,f,h.Dataframe.of({}));return X.of(y,p,b,z)}var dn=Object.defineProperty,fn=Object.getOwnPropertyDescriptor,mn=(s,t,e,n)=>{for(var r=n>1?void 0:n?fn(t,e):t,o=s.length-1,i;o>=0;o--)(i=s[o])&&(r=(n?i(t,e,r):i(r))||r);return n&&r&&dn(t,e,r),r};let N=class{constructor(s,t,e){c(this,"aes");c(this,"other");this.domain=s,this.norm=t,this.codomain=e}static of(s,t=w.default(),e=w.default()){return new N(s,t,e)}static default(){return new N(w.default(),w.default(),w.default())}deepClone(){const{domain:s,norm:t,codomain:e,aes:n,other:r}=this,o=new N(s,t,e);return o.setAes(n).setOther(r),o}setOther(s){return this.other=s,this}setAes(s){return this.aes=s,this}setDomain(s){return s?(this.domain=s,this):this}setNorm(s){return s?(this.norm=s,this):this}setCodomain(s){return s?(this.codomain=s,this):this}pushforward$(s){const{domain:t,norm:e,codomain:n}=this;return n.unnormalize$(e.unnormalize$(t.normalize$(s)))}pullback$(s){const{domain:t,norm:e,codomain:n}=this;return t.unnormalize$(e.normalize$(n.normalize$(s)))}domainMin$(){return this.domain instanceof w?this.domain.unnormalize$(this.norm.normalize$(0)):NaN}domainMax$(){return this.domain instanceof w?this.domain.unnormalize$(this.norm.normalize$(1)):NaN}codomainMin$(){return this.codomain.min$()}codomainMax$(){return this.codomain.max$()}setDomainMin$(s){if(!(this.domain instanceof w))return this;if(this.norm.setMin$===H)return;const t=this.domain.normalize$(s),e=this.norm.normalize$(1),[n,r]=ot(t,e);return E(()=>{this.norm.setMin$(n),this.norm.setMax$(r)}),this}setDomainMax$(s){if(!(this.domain instanceof w))return this;if(this.norm.setMax$===H)return;const t=this.norm.normalize$(0),e=this.domain.normalize$(s),[n,r]=ot(t,e);return E(()=>{this.norm.setMin$(n),this.norm.setMax$(r)}),this}setWeights$(s){if(!(this.domain instanceof w))return this.domain.setWeights$(s),this}defaultOrder$(){if(!(this.domain instanceof w))return this.domain.defaultOrder$(),this}orderBy$(s){if(!(this.domain instanceof w))return this.domain.orderBy$(s),this}freezeMin(){return this.norm.setMin$=H,this}freezeMax(){return this.norm.setMax$=H,this}breaks$(){const{domain:s}=this;return s.breaks$(this)}getWidget(){return this.domain.getWidget(this)}};N=mn([D([at,_t])],N);function ue(s){return class extends s{n(){return this.array.length}clear(){return this.array.length=0,this}push(t){return this.array.push(t)}valueAt(t,e){return this.array[t+(e??0)]}updateAt(t,e){return this.array[t]=e,this}values(){const t=this.n(),e=[];for(let n=0;n<t;n++)e.push(this.valueAt(n));return e}}}function as(s){return class extends s{map(t){return q.of((e,n)=>t(n.valueAt(e)),this)}}}function pn(s){return class extends s{constructor(){super(...arguments);c(this,"_parent")}setParent(e){return this._parent=e,this}}}function cs(s){return class extends s{constructor(){super(...arguments);c(this,"_proxyIndices");c(this,"_isProxied",!1)}isProxied(){return this._isProxied}proxyIndices(){return this._proxyIndices}proxy(e){const n=this,r=this.shallowClone();return r._proxyIndices=e,r._isProxied=!0,r.n=function(){return e.length},r.valueAt=function(o,i){return n.valueAt(e[o],i)},r}}}function he(s){return class extends s{constructor(){super(...arguments);c(this,"_queryable",!1)}isQueryable(){return this._queryable}setQueryable(e){return this._queryable=e,this}}}function de(s){return class extends s{constructor(){super(...arguments);c(this,"reducer")}setReducer(e){return this.reducer=e,this}parent(){if(!this.reducer.parent)return this;const{factor:e,parent:n}=this.reducer,r=e.parent.indices();return n.variable().deepClone().proxy(r)}stack(){return this.reducer.stack(this.deepClone())}normalizeByParent(){return this.reducer.normalizeByParent(this.deepClone())}shiftLeft(){const e=this,n=this.shallowClone();return n.valueAt=function(r){return r===0?e.reducer.reducer.initialfn():e.valueAt(r,-1)},n}}}function fe(s){return class extends s{setScale(t){return this.scale=t,this}setDomain(t){return this.domain=t,this.scale.domain=t,this}retrain(){return this.domain.retrain$(),this}scaledAt$(t){return this.scale.pushforward$(this.valueAt(t))}normalizedAt$(t){return this.domain.normalize$(this.valueAt(t))}}}var yn=Object.defineProperty,$n=Object.getOwnPropertyDescriptor,wt=(s,t,e,n)=>{for(var r=n>1?void 0:n?$n(t,e):t,o=s.length-1,i;o>=0;o--)(i=s[o])&&(r=(n?i(t,e,r):i(r))||r);return n&&r&&yn(t,e,r),r};function Et(s){return class extends pn(cs(_t(he(at(s))))){derive(t){return q.of(t,this)}}}let K=class{constructor(s,t){c(this,"array");c(this,"domain");c(this,"scale");this.array=s,this.domain=t??w.from(s),this.scale=N.of(this.domain)}static of(s,t){return new K(s,t)}static default(){return new K([])}deepClone(){const{array:s,scale:t,reducer:e}=this,n=K.of([...s]);return n.setScale(t).setReducer(e),this.hasName()&&n.setName(this.name()),this.isQueryable()&&n.setQueryable(!0),this.isProxied()?n.proxy(this.proxyIndices()):n}bin(s,t){return un(this,s,t)}range(){return this.max()-this.min()}min(){return S(()=>this.domain.min$())}max(){return S(()=>this.domain.max$())}};K=wt([D([Et,as,ue,de,fe])],K);let nt=class{constructor(s,t){c(this,"array");c(this,"domain");c(this,"scale");this.array=s.map(Re),this.domain=t??mt.from(this.array),this.scale=N.of(this.domain)}static of(s,t){return new nt(s,t)}static default(){return new nt([])}deepClone(){const{array:s,scale:t,reducer:e}=this,n=nt.of([...s]);return n.setScale(t).setReducer(e),this.hasName()&&n.setName(this.name()),this.isQueryable()&&n.setQueryable(!0),this.isProxied()?n.proxy(this.proxyIndices()):n}factor(s){return ln(this,s)}labels(){return this.domain.values$()}width(){return this.derive((s,t)=>{var e,n;return(n=(e=t.scale.domain).width$)==null?void 0:n.call(e,t.valueAt(s))})}setValues$(s){this.domain.setValues$(s)}};nt=wt([D([Et,as,ue,de,fe])],nt);let R=class{constructor(s){c(this,"array");this.array=s}static of(s){return new R(s)}static default(){return new R([])}deepClone(){const{array:s}=this,t=R.of([...s]);return this.hasName()&&t.setName(this.name()),this.isQueryable()&&t.setQueryable(!0),this.isProxied()?t.proxy(this.proxyIndices()):t}};R=wt([D([Et,ue,de])],R);let yt=class{constructor(s){c(this,"variables");c(this,"domain",w.default());c(this,"scale",N.default());this.variables=s.map(t=>t.shallowClone())}static of(s){return new yt(s)}length(){return this.variables.length}retrain(){}setDomain(s){var t;this.domain=s,this.scale.domain=s;for(const e of this.variables)(t=e.setDomain)==null||t.call(e,s);return this}setScale(s){var t;this.scale=s;for(const e of this.variables)(t=e.setScale)==null||t.call(e,s.deepClone().setDomain(e.domain));return this}setCommonDomain(s){if(!s)return this;let[t,e]=[1/0,-1/0];const n=w.of(t,e),r="Common domain can be implemented with continuous variables only";for(const o of this.variables){if(!(o instanceof K))throw new Error(r);const[i,a]=[o.min(),o.max()];t=Math.min(t,i),e=Math.max(e,a),o.domain=n}return n.setMin$(t).setMax$(e),this.domain=n,this}valueAt(s,t){return this.variables[t].valueAt(s)}scaledAt$(s,t){return this.variables[t].scaledAt$(s)}valuesAt(s){const t=[],e=this.length();for(let n=0;n<e;n++)t.push(this.valueAt(s,n));return t}};yt=wt([D([at,cs,_t])],yt);let q=class{constructor(s,t){c(this,"derivefn");c(this,"variable");c(this,"scale",N.default());c(this,"domain",w.default());this.derivefn=s,this.variable=t}static of(s,t){return new q(s,t)}valueAt(s){return this.derivefn(s,this.variable)}};q=wt([D([Et,fe])],q);var gn=Object.defineProperty,bn=Object.getOwnPropertyDescriptor,ls=(s,t,e,n)=>{for(var r=n>1?void 0:n?bn(t,e):t,o=s.length-1,i;o>=0;o--)(i=s[o])&&(r=(n?i(t,e,r):i(r))||r);return n&&r&&gn(t,e,r),r};function xn(s){if(s==="continuous")return new me;if(s==="discrete")return new pe}function us(s){return class extends s{addToQueries(){return this.setQueryable(!0),this}}}let me=class{constructor(){c(this,"_center",!1);c(this,"_scale",!1)}parse(s){if(!ts(s))throw new Error("Values in array are not numbers");if(this._scale||this._center){const e={mean:0,sumSquares:0,sd:0};for(let n=0;n<s.length;n++){const{mean:r,sumSquares:o}=e,i=s[n],a=r,l=(n*r+i)/(n+1),u=o+(i-a)*(i-l);e.mean=l,e.sumSquares=u}e.sd=Math.sqrt(e.sumSquares/s.length);for(let n=0;n<s.length;n++){const r=this._center?e.mean:0,o=this._scale?e.sd:1;s[n]=(s[n]-r)/o}}return K.of(s).setName(this.name()).setQueryable(this.isQueryable())}center(){return this._center=!0,this}scale(){return this._scale=!0,this}};me=ls([D([at,he,us])],me);let pe=class{constructor(){c(this,"mapfn",Y)}parse(s){if(!Xs(s))throw new Error("Values in array are not stringable");return nt.of(s.map(this.mapfn)).setName(this.name()).setQueryable(this.isQueryable())}capitalize(){const{mapfn:s}=this;return this.mapfn=t=>Be(s(t)),this}toLowercase(){const{mapfn:s}=this;return this.mapfn=t=>s(t).toLocaleLowerCase(),this}toUppercase(){const{mapfn:s}=this;this.mapfn=t=>s(t).toLocaleUpperCase()}stripWhitespace(){const{mapfn:s}=this;this.mapfn=t=>s(t).replace(/\s/g,"")}};pe=ls([D([at,he,us])],pe);const ye=[6,5,4],F={Transient:255,Group1:7,get Group2(){return ye[0]},get Group3(){return ye[1]},get Group4(){return ye[2]}};function vn(s){return s&-5}function wn(s){return s|4}const An=[0,1,2,3],hs=R.of(J(0,7)),Kt=Array.from(Array(8),()=>new Set),Mn=R.of(Kt),Sn={[le]:hs,[pt]:Mn},Pn=h.Dataframe.of(Sn);class $e{constructor(t){c(this,"data");c(this,"indices");c(this,"group");c(this,"transientPositions");c(this,"positionsArray");c(this,"factor$");c(this,"setFactor$");this.n=t,this.data=Pn,this.indices=Array(t).fill(F.Group1),this.group=F.Transient,this.positionsArray=Kt,this.positionsArray[7]=new Set(J(0,t-1)),this.transientPositions=new Set;const{indices:e,data:n}=this,[r,o]=x(X.of(8,e,n));this.factor$=r,this.setFactor$=o}static of(t){return new $e(t)}setGroup(t){this.group=t}update$(t){const{data:e,indices:n,positionsArray:r,transientPositions:o,group:i}=this;if(this.clearTransient(),!t.size){this.setFactor$(X.of(8,n,e));return}for(const a of r)for(const l of t)a.delete(l);if(i===F.Transient)for(const a of t){const l=vn(n[a]);n[a]=l,r[l].add(a),o.add(a)}else for(const a of t)n[a]=i,r[i].add(a);this.setFactor$(X.of(8,n,e))}clearAll(){for(const t of Kt)t.clear();for(let t=0;t<this.n;t++)Kt[F.Group1].add(t);this.indices.fill(F.Group1)}clearTransient(){const{indices:t,positionsArray:e,transientPositions:n}=this;for(const r of An)e[r].clear();for(const r of n){const o=wn(t[r]);t[r]=o,e[o].add(r)}n.clear()}data$(){const t=this.factor$(),e={};return e[le]=hs.proxy(t.indices()),e[pt]=q.of(n=>new Set([n])),h.Dataframe.of(e)}}class rt{constructor(t,e,n){c(this,"plot");c(this,"boundaryData$");c(this,"boundaryEncodefn",Y);c(this,"renderData$");c(this,"renderEncodefn",Y);c(this,"boundaryTrigger$");c(this,"renderTrigger$");this.plot=t;const[r,o]=x(void 0,{equals:!1}),[i,a]=x(void 0,{equals:!1});this.boundaryTrigger$=o,this.renderTrigger$=a,this.boundaryData$=()=>es(r)(()=>this.encodeData(e(),this.boundaryEncodefn)),this.renderData$=()=>es(i)(()=>this.encodeData(n(),this.renderEncodefn))}static of(t,e,n){return new rt(t,e,n)}encodeData(t,e){const{plot:n}=this,r=e(t.columns);r.size||(r.size=q.of(()=>.25)),r.width||(r.width=q.of(()=>1)),r.area||(r.area=q.of(()=>1));for(const i of Object.keys(r)){if(r[i]===void 0)continue;const a=i.slice(0,1),l=["x","y"].includes(a)?a:i,u=n.scales[l];r[i].setScale(u)}const o=Object.assign(t.columns,r);return h.Dataframe.of(o,{},t.queryables)}encodeBoundary(t){return this.boundaryEncodefn=t,this.boundaryTrigger$(),this}encodeRender(t){return this.renderEncodefn=t,this.renderTrigger$(),this}encode(t){return this.encodeBoundary(t).encodeRender(t)}}var ds=(s=>(s.X="x",s.Y="y",s))(ds||{}),G=(s=>(s[s.Absolute=0]="Absolute",s[s.Proportion=1]="Proportion",s))(G||{}),At=(s=>(s[s.ByName=0]="ByName",s[s.ByCount=1]="ByCount",s))(At||{}),Wt=(s=>(s[s.Middle=.5]="Middle",s[s.Top=1]="Top",s[s.Bottom=0]="Bottom",s))(Wt||{}),ge=(s=>(s[s.Center=.5]="Center",s[s.Left=1]="Left",s[s.Right=0]="Right",s))(ge||{});class Q{constructor(t){c(this,"container");c(this,"canvas");c(this,"context");c(this,"width",0);c(this,"height",0);c(this,"clipped",!1);c(this,"margins",[0,0,0,0]);c(this,"scalingFactor",2);c(this,"fontsize",16);c(this,"contextProps");c(this,"resize",()=>{const{context:t,canvas:e,contextProps:n,scalingFactor:r,clipped:o}=this,{clientWidth:i,clientHeight:a,clientLeft:l,clientTop:u}=this.canvas,m=i-l,p=a-u;this.width=m,this.height=p,e.width=m*r,e.height=p*r;for(const[d,f]of ut(n))t[d]=f;t.scale(r,r),o&&this.clip()});this.container=t,this.canvas=v("canvas").addClass("ps-plot-context").appendTo(t).get(),this.context=this.canvas.getContext("2d"),this.contextProps={},this.resize()}static of(t){return new Q(t)}setId(t){return this.canvas.id=t,this}addClasses(...t){for(const e of t)this.canvas.classList.add(e);return this}setStyles(t){for(const[e,n]of ut(t))this.canvas.style[e]=n;return this}getProp(t){return this.context[t]}setProps(t){for(const[e,n]of ut(t))this.contextProps[e]=this.context[e]=n;return this}setMargins(t){return this.clipped=!0,this.margins=t,this}clear(){const{context:t,width:e,height:n}=this;t.clearRect(0,0,e,n)}clip(){let{context:t,width:e,height:n}=this;const[r,o,i,a]=this.margins;e=e-o-a,n=n-i-r,t.beginPath(),t.rect(o,i,e,n),t.clip()}textWidth(t){return this.context.measureText(t).width}textHeight(t){const e=this.context.measureText(t);return e.actualBoundingBoxAscent+e.actualBoundingBoxDescent}point(t,e,n,r){const{context:o,height:i}=this,a=(r==null?void 0:r.horizontalAnchor)??ge.Center,l=(r==null?void 0:r.verticalAnchor)??Wt.Middle;n=n??5,t=t+2*(a-.5)*n,e=i-e+2*(.5-l)*n,o.beginPath(),o.arc(t,e,n,0,Math.PI*2),o.fill()}rectangleXY(t,e,n,r){const{context:o,height:i}=this;o.fillRect(t,i-e,n-t,e-r)}rectangleWH(t,e,n,r,o){const{context:i,height:a}=this,l=(o==null?void 0:o.horizontalAnchor)??ge.Center,u=(o==null?void 0:o.verticalAnchor)??Wt.Middle;t=t-l*n,e=a-e+u*r,i.fillRect(t,e,n,-r)}line(t,e){const{context:n,height:r}=this;n.beginPath(),n.moveTo(t[0],r-e[0]);for(let o=1;o<t.length;o++)n.lineTo(t[o],r-e[o]);n.stroke()}text(t,e,n,r=!1){const{context:o,height:i}=this;o.save(),o.translate(t,i-e),r&&o.rotate(-Math.PI/2),o.fillText(n,0,0),o.translate(-t,-(i-e)),o.restore()}}class It{constructor(t){this.scale=t}static of(t){return new It(t)}render(t){const{scale:e}=this,n=e.aes,r=t[`${n}Axis`],o=e.breaks$(),i=Je(o),[a,l,u,m]=bt(),p=e.other.codomainMin$()-r.fontsize*.5;if(r.clear(),n==="x"){let d=0,f=0;for(let $=0;$<i.length;$++){const y=i[$],b=e.pushforward$(o[$]),z=r.textWidth(y)+5;b<l||b>r.width-m||zn(d,b,f,z)||(r.text(b,p,y),d=b,f=z)}}else if(n==="y"){let d=0;for(let f=0;f<i.length;f++){const $=i[f],y=e.pushforward$(o[f]),b=r.textHeight($)+5;y<a||y>r.height-u||y-b<d||(r.text(p,y,$),d=y)}}}}function zn(s,t,e,n){const[r,o]=[s-e/2,s+e/2],[i,a]=[t-n/2,t+n/2];return r<a&&o>=i}class Lt{constructor(t){this.scale=t}static of(t){return new Lt(t)}render(t){const e=this.scale.aes,n=t.base,r=this.scale.name(),o=bt(),i=e==="x"?o[0]:o[1],a=this.scale.codomain.unnormalize$(.5),l=this.scale.other.codomain.unnormalize$(0)-i*(2/3);e==="x"?n.text(a,l,r):e==="y"&&n.text(l,a,r,!0)}}class be{constructor(t){c(this,"plot");c(this,"container");this.plot=t,this.container=v("div").appendTo(this.plot.container).addClass("ps-query-display").get()}static of(t){return new be(t)}clear(){return this.container.style.display="none",this}renderQuery(t,e,n){if(!n)return;let r="";for(const[p,d]of Object.entries(n))r+=`${p}: ${Je(d,{decimalPlaces:9})}<br>`;const{container:o,plot:i}=this,{clientWidth:a,clientHeight:l}=i.container;o.innerHTML=r,o.style.display="inline-block";const u=getComputedStyle(o),m=parseFloat(u.width.slice(0,-2));return t+m>a?(o.style.left="auto",o.style.right=`${a-t+5}px`):(o.style.left=`${t+5}px`,o.style.right="auto"),o.style.top=`${l-e}px`,this}}class xe{constructor(){c(this,"coords$");c(this,"setCoords$");const[t,e]=x([0,0,0,0]);this.coords$=t,this.setCoords$=e}static default(){return new xe}clear$(){this.setCoords$([0,0,0,0])}render(t){const[e,n,r,o]=this.coords$();t.user.clear(),t.user.rectangleXY(e,n,r,o)}}class ve{constructor(t){c(this,"plot");c(this,"modal");c(this,"container");c(this,"widgets");c(this,"intialized",!1);this.plot=t,this.container=v("div").append(v("h2").text("Parameters").get()).listen("click",e=>e.stopPropagation()).get(),this.modal=v("dialog").append(this.container).appendTo(t.container).addClass("ps-widget-modal").listen("click",()=>this.modal.close()).get(),this.widgets={},t.addKeyAction("KeyP",e=>{if(e.preventDefault(),!this.intialized){for(const n of Object.values(this.widgets))this.container.appendChild(n.getWidget());this.intialized=!0}this.modal.showModal()})}static of(t){return new ve(t)}registerWidget(t,e){return this.widgets[t]=e,this}}class we{constructor(t){c(this,"coords");this.coords=[t]}static default(){const{defaultNormX:t,defaultNormY:e}=ft,[n,r]=ot(t,1-t),[o,i]=ot(e,1-e);return new we([n,o,r,i])}push(t){return this.coords.push(t),this}clear(){this.coords.length=1}isEmpty(){return this.coords.length===1}currentInverse(){const t=gt(this.coords),[e,n]=ot(t[0],t[2]),[r,o]=ot(t[1],t[3]);return[e,r,n,o]}currentStretch(){if(this.isEmpty())return[1,1,1];const[t,e,n,r]=this.currentInverse(),o=n-t,i=r-e,a=Math.max(o,i);return[o,i,a]}pop(){return this.coords.pop(),gt(this.coords)}}const fs=[0,1,2,3,4,5,6,7],ms=[4,5,6,7];class ct{constructor(t){c(this,"scene");c(this,"container");c(this,"contexts");c(this,"scales");c(this,"renderables",[]);c(this,"selectables",[]);c(this,"queryables",[]);c(this,"selectionRect",xe.default());c(this,"zoomStack",we.default());c(this,"queryRenderer");c(this,"widgets");c(this,"active",!1);c(this,"mousedown",!1);c(this,"mode",0);c(this,"mousebutton",0);c(this,"lastX",0);c(this,"lastY",0);c(this,"lastKey","");c(this,"localKeyActions");c(this,"globalKeyActions");c(this,"onMousedown",t=>{const{scene:e,container:n,selectionRect:r}=this;if(e.deactivateAllExcept(this),this.activate(),this.mousedown=!0,this.mousebutton=t.button,t.button===0&&(this.mode=0),t.button===2&&(this.mode=1),this.mode===0){const{clientHeight:o}=n,i=t.offsetX,a=o-t.offsetY;r.setCoords$([i,a,i,a])}});c(this,"onMouseup",()=>{this.mousedown=!1});c(this,"onMouseleave",()=>{this.queryRenderer.clear()});c(this,"onMousemove",t=>{switch(this.mode){case 0:this.onMousemoveSelect(t);break;case 1:this.onMousemovePan(t);break;case 2:this.onMousemoveQuery(t)}});c(this,"onMousemoveSelect",t=>{if(!this.active||!this.mousedown)return;const{container:e,selectionRect:n}=this,{clientHeight:r}=e,o=t.offsetX,i=r-t.offsetY;n.setCoords$(a=>[a[0],a[1],o,i])});c(this,"onMousemovePan",t=>{if(!this.active||!this.mousedown)return;const{scales:e}=this,{clientWidth:n,clientHeight:r}=this.container,o=t.offsetX,i=r-t.offsetY,a=(o-this.lastX)/n,l=(i-this.lastY)/r;E(()=>{e.x.norm.setMin$(u=>u+a).setMax$(u=>u+a),e.y.norm.setMin$(u=>u+l).setMax$(u=>u+l)}),this.lastX=o,this.lastY=i});c(this,"onMousemoveQuery",t=>{const{offsetX:e,offsetY:n}=t,{clientHeight:r}=this.container,o=e,i=r-n;let a;for(const l of this.queryables)if(a=l.query(o,i),a)break;a?this.queryRenderer.renderQuery(o,i,a):this.queryRenderer.clear()});c(this,"onContextmenu",t=>{t.preventDefault(),this.selectionRect.clear$(),this.mousebutton=2,this.lastX=t.offsetX,this.lastY=this.container.clientHeight-t.offsetY});c(this,"onDoubleclick",()=>{this.deactivate(),this.scene.marker.clearAll()});c(this,"onKeydown",t=>{var e,n,r,o;t.code==="KeyQ"&&t.code===this.lastKey||(this.queryRenderer.clear(),(n=(e=this.globalKeyActions)[t.code])==null||n.call(e,t),this.active&&((o=(r=this.localKeyActions)[t.code])==null||o.call(r,t)),this.lastKey=t.code)});c(this,"onKeyup",()=>{this.mode=0,this.queryRenderer.clear(),this.lastKey=""});c(this,"onResize",()=>this.resize());c(this,"reset",()=>{const{container:t,scales:e,contexts:n,selectionRect:r,zoomStack:o}=this,{clientWidth:i,clientHeight:a}=t,[l,u,m,p]=bt(),d=i-u-p,f=a-m-l;S(()=>{e.x.norm.defaultize$(),e.y.norm.defaultize$(),e.size.codomain.defaultize$(),e.width.codomain.setMax$(d),e.area.codomain.setMax$(Math.min(d,f)),r.clear$()}),o.clear();for(const $ of Object.values(n))$.setProps({globalAlpha:1});this.render()});c(this,"zoom",()=>{const{scales:t,selectionRect:e,zoomStack:n}=this;let[r,o,i,a]=S(e.coords$);if(Math.abs(i-r)<10||Math.abs(a-o)<10)return;const{x:l,y:u}=t;S(()=>{r=l.norm.normalize$(Z(l.codomain.normalize$(r),0,1)),o=u.norm.normalize$(Z(u.codomain.normalize$(o),0,1)),i=l.norm.normalize$(Z(l.codomain.normalize$(i),0,1)),a=u.norm.normalize$(Z(u.codomain.normalize$(a),0,1))}),[r,i]=[r,i].sort(_),[o,a]=[o,a].sort(_),n.push([r,o,i,a]);const[m,p,d,f]=n.currentInverse(),[$,,y]=n.currentStretch();E(()=>{t.x.norm.setMin$(m).setMax$(d),t.y.norm.setMin$(p).setMax$(f),t.width.codomain.scale($),t.size.codomain.scale(U(y)),t.area.codomain.scale(U(y))}),e.clear$()});c(this,"unzoom",()=>{const{zoomStack:t,scales:e}=this;if(t.isEmpty())return;let[n,,r]=t.currentStretch();t.pop();const[o,i,a,l]=t.currentInverse();n=1/n,r=1/r,E(()=>{e.x.norm.setMin$(o).setMax$(a),e.y.norm.setMin$(i).setMax$(l),e.width.codomain.scale(n),e.size.codomain.scale(U(r)),e.area.codomain.scale(U(r))})});c(this,"increaseAlpha",()=>{const{contexts:t}=this;for(const e of ms){const n=t[e],r=n.getProp("globalAlpha");n.setProps({globalAlpha:Z(r*1.1111111111111112,0,1)})}this.render()});c(this,"decreaseAlpha",()=>{const{contexts:t}=this;for(const e of ms){const n=t[e],r=n.getProp("globalAlpha");n.setProps({globalAlpha:Z(r*.9,0,1)})}this.render()});this.scene=t;const e=v("div").addClass("ps-plot-container").get();this.container=e;const n={};this.contexts=n;const{groupColors:r,axisTitleFontsize:o,axisLabelFontsize:i}=ft,a=bt();for(const y of fs)n[y]=Q.of(e).setId(`data-layer${y}`).addClasses("ps-plot-context").setStyles({zIndex:`${7-y+1}`}).setProps({fillStyle:r[y],strokeStyle:r[y]}).setMargins(a);n.base=Q.of(e).addClasses("ps-plot-context","base").setStyles({backgroundColor:"whitesmoke"}).setProps({textAlign:"center",textBaseline:"middle",font:`${o}px sans`}),n.under=Q.of(e).setProps({fillStyle:"#fefffe",strokeStyle:"#00000000"}),n.over=Q.of(e).setStyles({zIndex:"10"}),n.user=Q.of(e).addClasses("ps-plot-context","user").setStyles({zIndex:"10"}).setProps({fillStyle:"#99999933",strokeStyle:"#00000000"}).setMargins(a),n.xAxis=Q.of(e).setProps({textBaseline:"top",textAlign:"center",font:`${i}px serif`,fillStyle:"#3B4854"}),n.yAxis=Q.of(e).setProps({textBaseline:"middle",textAlign:"right",font:`${i}px serif`,fillStyle:"#3B4854"});const[l,u,m,p]=a;this.pushRenderable({render(y){const b=y.under,{width:z,height:g}=b;b.rectangleXY(l,u,z-m,g-p)}}),this.pushRenderable({render(y){const b=y.over,{width:z,height:g}=b;b.line([l,l,z-m],[g-p,u,u])}}),this.scales={x:N.default(),y:N.default(),size:N.default(),width:N.default(),area:N.default()};const{scales:d}=this,{defaultNormX:f,defaultNormY:$}=ft;d.x.norm.setDefaultMin(f).setDefaultMax(1-f),d.x.norm.defaultize$(),d.y.norm.setDefaultMin($).setDefaultMax(1-$),d.y.norm.defaultize$(),d.x.setOther(d.y),d.y.setOther(d.x),d.size.codomain.setDefaultMin(1).setDefaultMax(10).defaultize$(),d.width.norm.setDefaultMin(0).setDefaultMax(1-2*f),d.width.norm.defaultize$(),d.size.norm.transform(zt,U),d.area.norm.transform(zt,U);for(const y of Object.keys(d))d[y].setAes(y);this.pushRenderable(It.of(d.x)),this.pushRenderable(It.of(d.y)),this.pushRenderable(Lt.of(d.x)),this.pushRenderable(Lt.of(d.y)),window.addEventListener("resize",ne(this.onResize,100)),window.addEventListener("dblclick",this.onDoubleclick),e.addEventListener("mousedown",this.onMousedown),e.addEventListener("contextmenu",this.onContextmenu),e.addEventListener("mouseup",this.onMouseup),e.addEventListener("mousemove",ne(this.onMousemove,30)),e.addEventListener("mouseleave",this.onMouseleave),window.addEventListener("keydown",this.onKeydown),window.addEventListener("keyup",this.onKeyup),this.localKeyActions={KeyR:this.reset,KeyZ:this.zoom,KeyX:this.unzoom,BracketLeft:this.decreaseAlpha,BracketRight:this.increaseAlpha},this.globalKeyActions={KeyQ:()=>this.mode=2},this.queryRenderer=be.of(this),this.widgets=ve.of(this),this.widgets.registerWidget("x",d.x).registerWidget("y",d.y),this.pushRenderable(this.selectionRect),ht(()=>this.updateMarker$()),this.scene.addPlot(this)}static linkScales(t,e){for(const n of ee(t.scales))t.scales[n].domain===e.scales[n].domain&&(t.scales[n].norm=e.scales[n].norm)}clearContexts(){for(const t of Object.values(this.contexts))t.clear()}pushRenderable(t){if(this.renderables.push(t),t.keyActions)for(const[e,n]of Object.entries(t.keyActions))this.localKeyActions[e]?this.localKeyActions[e]=Pt(this.localKeyActions[e],n):this.localKeyActions[e]=n;return ht(()=>t.render(this.contexts)),this}pushSelectable(t){return this.selectables.push(t),this}pushQueryable(t){return this.queryables.push(t),this}pushRepresentation(t){return this.pushQueryable(t).pushSelectable(t).pushRenderable(t),this}trainScalesOnce(t){var r;const{columns:e}=t(),{scales:n}=this;for(const[o,i]of Object.entries(e)){i&&((r=i.retrain)==null||r.call(i));let a;o.startsWith("x")&&(a=n.x),o.startsWith("y")?a=n.y:["area","size","width"].includes(o)&&(a=n[o]),a&&(a.setDomain(i.domain),!a.hasName()&&i.hasName()&&a.setName(i.name()))}return this.render(),this}trainScales$(t){return ht(()=>this.trainScalesOnce(t)),this}addKeyAction(t,e){return this.localKeyActions[t]?this.localKeyActions[t]=Pt(this.localKeyActions[t],e):this.localKeyActions[t]=e,this}addKeyActions(t){for(const[e,n]of ut(t))this.localKeyActions[e]?this.localKeyActions[e]=Pt(this.localKeyActions[e],n):this.localKeyActions[e]=n;return this}render(){for(const t of Object.values(this.contexts))t.clear();for(const t of this.renderables)S(()=>t.render(this.contexts))}activate(){this.active=!0,this.container.classList.add("active"),this.queryRenderer.clear()}deactivate(){this.active=!1,this.container.classList.remove("active"),this.selectionRect.clear$(),this.queryRenderer.clear(),this.render()}resize(){const{contexts:t,scales:e,container:n}=this;for(const d of Object.values(t))d.resize();const{clientWidth:r,clientHeight:o}=n,[i,a,l,u]=bt(),m=r-a-u,p=o-l-i;S(()=>{e.x.codomain.setMin$(a).setMax$(r-u),e.y.codomain.setMin$(i).setMax$(o-l),e.width.codomain.setMin$(0).setMax$(m),e.area.codomain.setMax$(Math.min(m,p))}),this.render()}updateMarker$(){const t=this.selectionRect.coords$(),e=new Set;for(const n of this.selectables)S(()=>re(e,n.check(t)));this.scene.marker.update$(e)}}var kn=Object.defineProperty,On=Object.getOwnPropertyDescriptor,Nn=(s,t,e,n)=>{for(var r=n>1?void 0:n?On(t,e):t,o=s.length-1,i;o>=0;o--)(i=s[o])&&(r=(n?i(t,e,r):i(r))||r);return n&&r&&kn(t,e,r),r};let lt=class{constructor(s,t,e){c(this,"initialfn");c(this,"reducefn");c(this,"afterfn",Y);this.initialfn=s,this.reducefn=t,e&&(this.afterfn=e)}static of(s,t,e){return new lt(s,t,e)}setAfterfn(s){return new lt(this.initialfn,this.reducefn,s)}};lt=Nn([D([at])],lt);const Xt=lt.of(Jt,je).setName("sum");lt.of(Jt,Math.max).setName("max"),lt.of(Oe,Te).setName("product");class Mt{constructor(t){c(this,"encoder");c(this,"keyActions");this.encoder=t,this.keyActions={}}render(t){const e=this.encoder.renderData$(),n=e.n();for(const r of fs)t[r].clear();for(let r=0;r<n;r++){const o=e.columns[le].valueAt(r);this.renderGroup(t[o],e,r)}}check(t){const{encoder:e}=this,n=S(e.boundaryData$),r=n.n(),o=new Set;for(let i=0;i<r;i++){const a=n.col(pt).valueAt(i);this.checkObject(t,n,i)&&re(o,a)}return o}query(t,e){const n=S(this.encoder.boundaryData$),r=n.n();for(let o=0;o<r;o++){const i=this.queryObject(t,e,n,o);if(i)return i}}}class Ae extends Mt{constructor(e){super(e);c(this,"widthPct$");c(this,"setWidthPct$");c(this,"options",{verticalAnchor:Wt.Bottom});const[n,r]=x(.8);this.widthPct$=n,this.setWidthPct$=r,this.keyActions.Equal=()=>r(o=>te(o*10/9)),this.keyActions.Minus=()=>r(o=>te(o*9/10)),this.keyActions.KeyR=()=>r(.8)}static of(e){return new Ae(e)}renderGroup(e,n,r){const o=n.col("x").scaledAt$(r),i=n.col("y0").scaledAt$(r),a=n.col("y1").scaledAt$(r),l=n.col("width").scaledAt$(r),u=Math.floor((1-this.widthPct$())*l);e.rectangleWH(o,i,l-u/2,a-i,this.options)}checkObject(e,n,r){const o=n.col("x").scaledAt$(r),i=n.col("y0").scaledAt$(r),a=n.col("y1").scaledAt$(r),l=n.col("width").scaledAt$(r)/2,u=Math.floor((1-this.widthPct$())*l);return tt(e,[o-l+u,i,o+l-u,a])}queryObject(e,n,r,o){const i=r.col("x").scaledAt$(o),a=r.col("y0").scaledAt$(o),l=r.col("y1").scaledAt$(o),u=r.col("width").scaledAt$(o),m=Math.floor((1-this.widthPct$())*u),p=[i-u/2+m,a,i+u/2-m,l];if(tt([e,n,e,n],p)){const d={};d[r.col("x").name()]=r.col("x").valueAt(o),d[r.col("stat1").name()]=r.col("stat1").valueAt(o);for(const f of r.queryables)d[f.name()]=f.valueAt(o);return d}}}class Ft extends ct{constructor(e,n,r){super(e);c(this,"along",ds.X);c(this,"type",G.Absolute);c(this,"order",At.ByName);c(this,"encoder");const o=(r==null?void 0:r.reducer)??Xt,i=e.data.select(n).addReducer("stat1",b=>b.v2??st(),o),a=()=>i.col("v1").factor(),l=()=>a().nest(e.marker.factor$()),u=()=>i.reduceBy(a()),m=()=>i.reduceBy(l(),u),p=rt.of(this,u,m);this.encoder=Ls(this.type,ps,ys)(p);const d=Ae.of(this.encoder);this.pushRepresentation(d);const{scales:f}=this,$=i.reducers.stat1.formatTitle();this.trainScalesOnce(this.encoder.boundaryData$),f.y.freezeMin(),f.y.setName($);let y=S(d.widthPct$);this.addKeyActions({KeyR:()=>f.x.defaultOrder$(),KeyO:()=>{if(this.order===At.ByName){const b=S(this.encoder.boundaryData$).col("stat1");f.x.orderBy$(b.values()),this.order=At.ByCount}else f.x.defaultOrder$(),this.order=At.ByName;this.render()},KeyN:()=>{if(this.type===G.Absolute){this.encoder=ys(this.encoder);const b=S(this.encoder.boundaryData$).col("stat1");this.trainScalesOnce(this.encoder.boundaryData$);let z="proportion";$!="count"&&(z=`percent of ${$}`),f.x.setWeights$(b.values()),f.y.setName(z),y=S(d.widthPct$),d.setWidthPct$(1),this.type=G.Proportion}else{this.encoder=ps(this.encoder),this.trainScalesOnce(this.encoder.boundaryData$);const b=S(a)._cardinality;f.x.setWeights$(ss(1,b)),f.y.setName($),d.setWidthPct$(y),this.type=G.Absolute}this.render()}}),this.render()}static of(e,n,r){return new Ft(e,n,r)}}function ps(s){return s.encodeBoundary(t=>({x:t.label,y0:et(),y1:t.stat1,width:t.label.width()})).encodeRender(t=>({x:t.label,y0:et(),y1:t.stat1.stack(),width:t.label.width()}))}function ys(s){return s.encodeBoundary(t=>({x:t.label,y0:et(),y1:st(),width:t.label.width()})).encodeRender(t=>({x:t.label,y0:et(),y1:t.stat1.stack().normalizeByParent(),width:t.label.width()}))}class Gt extends Mt{constructor(e){super(e);c(this,"sizeX");c(this,"setSizeX");const[n,r]=x(ft.defaultWidth);this.sizeX=n,this.setSizeX=r,this.keyActions.Equal=()=>r(o=>o*10/9),this.keyActions.Minus=()=>r(o=>o*9/10),this.keyActions.KeyR=()=>r(ft.defaultWidth)}static of(e){return new Gt(e)}renderGroup(e,n,r){const o=n.col("x").scaledAt$(r),i=n.col("y").scaledAt$(r),a=n.col("area").scaledAt$(r)*this.sizeX();e.rectangleWH(o,i,a,a)}checkObject(e,n,r){const o=n.col("x").scaledAt$(r),i=n.col("y").scaledAt$(r),a=n.col("area").scaledAt$(r)*this.sizeX();return tt(e,[o-a/2,i-a/2,o+a/2,i+a/2])}queryObject(e,n,r,o){const i=r.col("x").scaledAt$(o),a=r.col("y").scaledAt$(o),l=r.col("area").scaledAt$(o)*this.sizeX(),u=[i-l/2,a-l/2,i+l/2,a+l/2];if(tt([e,n,e,n],u)){const m={};return m[r.col("x").name()]=r.col("x").valueAt(o),m[r.col("y").name()]=r.col("y").valueAt(o),m[r.col("stat1").name()]=r.col("stat1").valueAt(o),m}}}class Qt extends ct{constructor(e,n){super(e);c(this,"type",0);c(this,"encoder");const r=e.data.select(n).addReducer("stat1",y=>y.v3??st(),Xt);r.reducers.stat1.formatTitle();const o=()=>r.col("v1").factor(),i=()=>r.col("v2").factor(),a=()=>o().nest(i()),l=()=>a().nest(e.marker.factor$()),u=()=>r.reduceBy(a()),m=()=>r.reduceBy(l(),u),p=rt.of(this,u,m);this.encoder=$s(p);const{scales:d}=this;this.trainScalesOnce(p.boundaryData$);const f=Math.max(o().cardinality(),i().cardinality());d.area.norm.setDefaultMax(1/f);const $=Gt.of(this.encoder);this.pushRepresentation($),this.addKeyActions({KeyR:()=>E(()=>{d.x.defaultOrder$(),d.y.defaultOrder$()}),KeyN:()=>{this.type===0?(this.encoder=Cn(this.encoder),this.type=1):(this.encoder=$s(this.encoder),this.type=0),this.render()}})}static of(e,n){return new Qt(e,n)}}function $s(s){return s.encodeBoundary(t=>({x:t.label,y:t.label$,area:t.stat1})).encodeRender(t=>({x:t.label,y:t.label$,area:t.stat1.stack()}))}function Cn(s){return s.encodeBoundary(t=>({x:t.label,y:t.label$,area:st().setName("proportion")})).encodeRender(t=>({x:t.label,y:t.label$,area:t.stat1.setName("proportion").stack().normalizeByParent()}))}class Me extends Mt{static of(t){return new Me(t)}renderGroup(t,e,n){const r=e.col("x0").scaledAt$(n),o=e.col("y0").scaledAt$(n),i=e.col("x1").scaledAt$(n),a=e.col("y1").scaledAt$(n);t.rectangleXY(r,o,i,a)}checkObject(t,e,n){const r=e.col("x0").scaledAt$(n),o=e.col("y0").scaledAt$(n),i=e.col("x1").scaledAt$(n),a=e.col("y1").scaledAt$(n);return tt(t,[r,o,i,a])}queryObject(t,e,n,r){const o=n.col("x0").scaledAt$(r),i=n.col("y0").scaledAt$(r),a=n.col("x1").scaledAt$(r),l=n.col("y1").scaledAt$(r);if(tt([t,e,t,e],[o,i,a,l])){const u={};u[`min ${n.col("x0").name()}`]=n.col("x0").valueAt(r),u[`max ${n.col("x1").name()}`]=n.col("x1").valueAt(r),u[n.col("stat1").name()]=n.col("stat1").valueAt(r);for(const m of n.queryables)u[m.name()]=m.valueAt(r);return u}}}class Ht{constructor(t,e){c(this,"container");c(this,"name$");c(this,"value$");c(this,"setName$");c(this,"setValue$");this.container=v("div").addClass("ps-widget-container").get();const[n,r]=x("");this.name$=n,this.value$=t,this.setValue$=e,this.setName$=r,ht(()=>this.render$())}static of(t,e){return new Ht(t,e)}getWidget(){return this.container}setName(t){return this.setName$(t),this}render$(){const t=this.name$(),e=this.value$(),n=v("div").html(t).addClass("ps-widget").get(),r=v("input").setAttribute("value",ae(e)).setAttribute("size",5).appendTo(n).listen("keydown",o=>{if(o.code!="Enter")return;const i=parseFloat(r.value);this.setValue$(i)}).addClass("ps-widget").get();this.container.replaceChildren(n)}}class Vt extends ct{constructor(e,n){super(e);c(this,"type",0);c(this,"encoder");const r=e.data.select(n).addReducer("stat1",()=>st(),Xt),o=r.col("v1").range()/20,i=r.col("v1").min(),a=o/10,[l,u]=x(o),[m,p]=x(i),d=()=>r.col("v1").bin(l(),m()),f=()=>d().nest(e.marker.factor$()),$=()=>r.reduceBy(d()),y=()=>r.reduceBy(f(),$),b=rt.of(this,$,y);this.encoder=gs(b);const z=Me.of(this.encoder);this.pushRepresentation(z);const{scales:g}=this;this.trainScales$(this.encoder.boundaryData$);const P=r.reducers.stat1.formatTitle();g.y.freezeMin(),g.y.setName(P);const St=Ht.of(l,u).setName("Binwidth: "),B=Ht.of(m,p).setName("Bin anchor: ");this.widgets.registerWidget("width",St).registerWidget("anchor",B),this.addKeyActions({Equal:()=>u(C=>C*10/9),Minus:()=>u(C=>C*9/10),Semicolon:()=>p(C=>C-a),Quote:()=>p(C=>C+a),KeyR:()=>E(()=>{u(o),p(i)}),KeyN:()=>{this.type===0?(this.encoder=Dn(this.encoder),this.scales.x.setName("cumulative count"),this.scales.y.setName("proportion"),this.type=1,this.render()):(this.encoder=gs(this.encoder),this.scales.x.setName(r.col("v1").name()),this.scales.y.setName("count"),this.type=0,this.render())}}),this.render()}static of(e,n){return new Vt(e,n)}}function gs(s){return s.encodeBoundary(t=>({x0:t.bin0,x1:t.bin1,y0:et(),y1:t.stat1})).encodeRender(t=>({x0:t.bin0,x1:t.bin1,y0:et(),y1:t.stat1.stack()}))}function Dn(s){return s.encodeBoundary(t=>({x0:t.stat1.stack().shiftLeft(),x1:t.stat1.stack(),y0:et(),y1:st()})).encodeRender(t=>({x0:t.stat1.parent().stack().shiftLeft(),x1:t.stat1.parent().stack(),y0:et(),y1:t.stat1.stack().normalizeByParent()}))}class Yt extends ct{constructor(e,n){super(e);c(this,"type",G.Absolute);c(this,"encoder");const r=e.data.select(n).addReducer("stat1",()=>st(),Xt),o=r.col("v1").range()/15,i=r.col("v2").range()/15,[a,l]=x(o),[u,m]=x(i),p=()=>r.col("v1").bin(a()),d=()=>r.col("v2").bin(u()),f=()=>p().nest(d()),$=()=>f().nest(e.marker.factor$()),y=()=>r.reduceBy(f()),b=()=>r.reduceBy($(),y),z=rt.of(this,y,b);this.encoder=bs(z);const g=Gt.of(this.encoder);g.setSizeX=H,this.pushRepresentation(g);const{scales:P}=this,St=Math.max(p()._cardinality,d()._cardinality);this.trainScales$(this.encoder.boundaryData$),P.area.norm.setDefaultMax(1/St),P.area.domain.transform(U,zt),this.addKeyActions({Equal:()=>{l(B=>B*10/9),m(B=>B*10/9)},Minus:()=>{l(B=>B*9/10),m(B=>B*9/10)},KeyR:()=>{l(o),m(i)},KeyN:()=>{this.type===G.Absolute?(this.encoder=Rn(this.encoder),this.type=G.Proportion):(this.encoder=bs(this.encoder),this.type=G.Absolute),this.render()}}),this.render()}static of(e,n){return new Yt(e,n)}}function bs(s){return s.encodeBoundary(t=>({x:t.binMid,y:t.binMid$,area:t.stat1})).encodeRender(t=>({x:t.binMid,y:t.binMid$,area:t.stat1.stack()}))}function Rn(s){return s.encodeBoundary(t=>({x:t.binMid,y:t.binMid$,area:st()})).encodeRender(t=>({x:t.binMid,y:t.binMid$,area:t.stat1.stack().normalizeByParent()}))}class Se extends Mt{static of(t){return new Se(t)}renderGroup(t,e,n){const r=e.col("x").length(),o=[],i=[];for(let a=0;a<r;a++)o.push(e.col("x").scaledAt$(n,a)),i.push(e.col("y").scaledAt$(n,a));t.line(o,i)}checkObject(t,e,n){const r=e.col("x"),o=e.col("y"),i=r.length();for(let a=1;a<i;a++){const l=r.scaledAt$(n,a-1),u=o.scaledAt$(n,a-1),m=r.scaledAt$(n,a),p=o.scaledAt$(n,a);if(Ze(t,[l,u,m,p]))return!0}return!1}queryObject(t,e,n,r){const o=n.col("x"),i=n.col("y"),a=o.length(),l=[t-1,e-1,t+1,e-1];for(let u=1;u<a;u++){const m=o.scaledAt$(r,u-1),p=i.scaledAt$(r,u-1),d=o.scaledAt$(r,u),f=i.scaledAt$(r,u);if(Ze(l,[m,p,d,f])){const $={};for(let y=0;y<a;y++)$[o.valueAt(r,y)]=i.valueAt(r,y);for(const y of n.queryables)$[y.name()]=y.valueAt(r);return $}}}}class Ut extends ct{constructor(t,e,n){super(t);const r=()=>t.data.select(e).zip("values",Y).create("names",l=>{const m=l.values.variables.map(f=>q.of(($,y)=>y.name(),f)),p=yt.of(m),d=xt.of(p.valuesAt(0));return p.setDomain(d),p}).join(t.marker.data$()),o=n!=null&&n.commonDomain?"value":"scaled value",i=rt.of(this,r,r).encode(l=>({x:l.names.setName("variable"),y:l.values.setName(o).setCommonDomain(n==null?void 0:n.commonDomain)}));this.trainScalesOnce(i.boundaryData$);const a=Se.of(i);this.pushRepresentation(a),this.render()}static of(t,e,n){return new Ut(t,e,n)}}class Pe extends Mt{constructor(e){super(e);c(this,"sizeX");c(this,"setSizeX");const[n,r]=x(1);this.sizeX=n,this.setSizeX=r,this.keyActions.Equal=()=>r(o=>o*10/9),this.keyActions.Minus=()=>r(o=>o*9/10),this.keyActions.KeyR=()=>r(1)}static of(e){return new Pe(e)}renderGroup(e,n,r){const o=n.col("x").scaledAt$(r),i=n.col("y").scaledAt$(r),a=n.col("size").scaledAt$(r)*this.sizeX();e.point(o,i,a)}checkObject(e,n,r){const o=n.col("x").scaledAt$(r),i=n.col("y").scaledAt$(r),l=n.col("size").scaledAt$(r)*this.sizeX()/Math.sqrt(2);return tt(e,[o-l,i-l,o+l,i+l])}queryObject(e,n,r,o){const i=r.col("x").scaledAt$(o),a=r.col("y").scaledAt$(o),u=r.col("size").scaledAt$(o)*this.sizeX()/Math.sqrt(2);if(tt([e,n,e,n],[i-u,a-u,i+u,a+u])){const m={};m[r.col("x").name()]=r.col("x").valueAt(o),m[r.col("y").name()]=r.col("y").valueAt(o);for(const p of r.queryables)m[p.name()]=p.valueAt(o);return m}}}class Zt extends ct{constructor(e,n){super(e);c(this,"encoder");const r=()=>e.data.select(n).join(e.marker.data$()),o=rt.of(this,r,r);this.encoder=o.encode(a=>({x:a.v1,y:a.v2,size:a.v3})),this.trainScalesOnce(o.boundaryData$);const i=Pe.of(this.encoder);this.pushRepresentation(i),this.render()}static of(e,n){return new Zt(e,n)}}const qn={scatter:Zt,histo:Vt,bar:Ft,fluct:Qt,histo2d:Yt,pcoords:Ut},Bn=new DOMParser().parseFromString(`<div>
    <br>
    <h1 class="ps-help-modal-heading">Welcome to Plotscape</h1>
    <hr>    
    <br>
    Try some of the following commands:
    <ul>
        <li> <b>Click/click and drag</b> to select objects transiently </li>
        <li>Hold <b>1/2/3</b> while dragging for permanent selection</li>
        <li><b>Right click and drag</b> to pan</li>
        <li>Hold <b>Q</b> and mouse-over objects to query them</li>
        <br>
        <li>Press <b>Z</b> to zoom into current selection</li>
        <li>Press <b>X</b> to pop one level of zoom</li>
        <li>Press <b>O</b> to order by statistic (barplot)</li> 
        <li>Press <b>N</b> to normalize (barplot/histogram/fluctuation plot)</li>
        <li>Press <b>P</b> to bring up parameter menu (axis limits)</li>
        <br>
        <li><b>Double-click</b> to reset any selection</li>
        <li>Press <b>R</b> to reset any graphical changes</li>
        <br>
        <li>Press <b>+/-</b> to change object size/width</li>
        <li>Press <b>[/]</b> to change opacity (unselected only)</li>
        <li>Press <b>;/'</b> to change histogram anchor</li>
    </ul>
</div>
`.replace(/(\r\n|\n|\r)/gm,""),"text/html").body,jn={showHelpModal:!0};class ze{constructor(t,e,n){c(this,"data");c(this,"container");c(this,"marker");c(this,"plots");c(this,"keyActionMap");c(this,"setRowsCols",(t,e)=>{document.documentElement.style.setProperty("--ncols",e.toString()),document.documentElement.style.setProperty("--nrows",t.toString());for(const n of this.plots)n.resize()});c(this,"setGroup",t=>this.marker.setGroup(t));c(this,"onMousedown",t=>{t.target===this.container&&this.deactivateAll()});c(this,"onKeydown",t=>{var e,n;(n=(e=this.keyActionMap)[t.code])==null||n.call(e)});c(this,"onKeyup",()=>{this.setGroup(F.Transient)});if(n=n??jn,this.data=e,this.container=v("div").addClass("ps-scene-container").appendTo(t).get(),this.marker=$e.of(e.n()),this.plots=[],window.addEventListener("mousedown",this.onMousedown),window.addEventListener("keydown",this.onKeydown),window.addEventListener("keyup",this.onKeyup),this.keyActionMap={Digit1:()=>this.setGroup(F.Group2),Digit2:()=>this.setGroup(F.Group3),Digit3:()=>this.setGroup(F.Group4)},n!=null&&n.showHelpModal){const r=v("dialog").appendTo(this.container).append(Bn).addClass("ps-help-modal").listen("click",function(){this.close()}).get();v("button").appendTo(this.container).addClass("ps-help-button").text("?").listen("click",()=>r.showModal()).get()}}static of(t,e,n){return new ze(t,e,n)}addPlot(t){this.container.appendChild(t.container),this.plots.push(t);const e=Math.ceil(Math.sqrt(this.plots.length)),n=Math.ceil(this.plots.length/e);this.setRowsCols(n,e)}addPlotByType(t,e){return qn[t].of(this,e),this}deactivateAll(){for(const t of this.plots)t.deactivate()}deactivateAllExcept(t){for(const e of this.plots)e!==t&&e.deactivate()}}return h.Barplot=Ft,h.Fluctplot=Qt,h.Histoplot=Vt,h.POJO=xs,h.ParallelCoords=Ut,h.Plot=ct,h.Scatter=Zt,h.Scene=ze,h.SquareHeatmap=Yt,h.allEntries=I,h.allKeys=se,h.allValues=Ee,h.applyMixins=D,h.asInt=qe,h.asString=Re,h.call=ws,h.capitalize=Be,h.chainable=V,h.col=xn,h.compareAlphaNumeric=$t,h.convertToSuperscript=We,h.createRoot=qs,h.cumsum=ks,h.diff=_,h.element=Ps,h.entries=ut,h.exponentialToSuperscript=Ie,h.fetchJSON=zs,h.firstArgument=As,h.identity=Y,h.inSequence=Pt,h.inc=Ce,h.invertRange=ot,h.just=T,h.keys=ee,h.last=gt,h.match=Os,h.mergeIntoSet=re,h.minMax=kt,h.noop=vs,h.noopThis=H,h.one=Oe,h.orderBy=_e,h.prettyBreaks=Ke,h.prod=Te,h.secondArgument=Ms,h.seq=J,h.square=zt,h.squareRoot=U,h.subsetOn=Ne,h.sum=je,h.throttle=ne,h.times=De,h.trunc=Z,h.trunc0to1=te,h.unary=ke,h.unwrap=Ss,h.unwrapAll=Cs,h.values=Ns,h.zero=Jt,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),h}({});
